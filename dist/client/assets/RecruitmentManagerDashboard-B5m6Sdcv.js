import{c as be,u as ze,a as Le,r as l,j as e,T as pe,L as ye,C as Pe,M as He,R as Ye,b as ee,N as Ve}from"./index-C7EJkjUr.js";import{C as Oe,a as re,b as qe,N as Je,T as ge,c as ie,A as te,e as Ae,R as Qe,D as Ke,F as Be,d as Xe,f as $e,B as Ge,i as Te,X as De,Y as Ee,h as Fe,j as We,L as Ze,k as Ie,aw as es,ay as ss,n as ts}from"./CompanyPage-bcY5Um_O.js";import{f as g}from"./api-D8SveD0E.js";import{L as as}from"./layout-dashboard-DLCMCygV.js";import{U as X}from"./users-C13lqfXm.js";import{L as ls}from"./log-out-D2TEcKqa.js";import{S as rs,L as Me,b as is,C as he,E as ns}from"./ScoreTooltip-CZNaDlST.js";import{B as ae}from"./briefcase-DAyzHxKh.js";import{L as os,U as fe,a as ds}from"./LineChart-CvRk5iVY.js";import{X as ne,P as ue,T as Ue,S as _e}from"./x-yUVYYHrF.js";import{B as je}from"./building-2-Cuz0WzKd.js";import{S as cs}from"./search-CUq3Q4fS.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],xs=be("arrow-down",ms);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],us=be("arrow-up",hs);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],gs=be("history",ps);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Se=be("user-plus",bs);function fs({children:d}){var _,h;const N=ze(),{user:a,logout:q}=Le(),[b,D]=l.useState(!0),[M,L]=l.useState(0);l.useEffect(()=>{w(),I()},[]);const w=async()=>{try{const i=await g("/api/company/settings");if(i.ok){const j=await i.json();D(j.show_company_page)}}catch(i){console.error("Failed to fetch company settings:",i)}},I=async()=>{try{const i=await g("/api/rm/dropout-requests");if(i.ok){const j=await i.json();L(j.length)}}catch(i){console.error("Failed to fetch pending dropouts:",i)}},v=[{path:"/rm",icon:as,label:"Dashboard"},{path:"/rm/analytics",icon:Oe,label:"Analytics"},{path:"/rm/roles",icon:pe,label:"Roles"},{path:"/rm/team",icon:X,label:"Team Management"},{path:"/rm/dropouts",icon:re,label:"Dropout Requests"},{path:"/rm/profile",icon:qe,label:"Profile"}];return b&&v.splice(5,0,{path:"/rm/company",icon:ge,label:"Company"}),e.jsxs("div",{className:"flex h-screen bg-gradient-to-br from-slate-50 to-blue-50",children:[e.jsxs("div",{className:"w-64 bg-white shadow-xl border-r border-slate-200",children:[e.jsx("div",{className:"p-6 border-b border-slate-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx(pe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-slate-800",children:"EBES"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Recruitment Manager"})]})]})}),e.jsx("div",{className:"px-4 py-3 border-b border-slate-200 bg-slate-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-lg flex items-center justify-center text-white font-semibold text-sm",children:((_=a==null?void 0:a.name)==null?void 0:_.charAt(0))||"U"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-800 truncate",children:a==null?void 0:a.name}),e.jsx("p",{className:"text-xs text-slate-500 truncate",children:a==null?void 0:a.user_code})]})]})}),e.jsxs("nav",{className:"mt-6 px-4",children:[v.map(i=>{const j=i.icon,U=N.pathname===i.path,u=i.path==="/rm/dropouts";return e.jsxs(ye,{to:i.path,className:`
                  flex items-center justify-between px-4 py-3 rounded-lg mb-2 transition-all duration-200
                  ${U?"bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg":"text-slate-600 hover:bg-slate-100 hover:text-slate-800"}
                `,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(j,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:i.label})]}),u&&M>0&&e.jsx("span",{className:"ml-auto px-2 py-0.5 bg-red-500 text-white text-xs font-bold rounded-full min-w-[20px] text-center",children:M})]},i.path)}),e.jsx("div",{className:"mt-8 pt-8 border-t border-slate-200",children:e.jsxs("button",{onClick:q,className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 transition-all duration-200",children:[e.jsx(ls,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Logout"})]})})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-slate-200 px-6 py-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:((h=v.find(i=>i.path===N.pathname))==null?void 0:h.label)||"Dashboard"}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx(Je,{})})]})}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:d})]})]})}function js(){const[d,N]=l.useState(null),[a,q]=l.useState(null),[b,D]=l.useState(0),[M,L]=l.useState(!0);l.useEffect(()=>{w()},[]),l.useEffect(()=>{const v=setInterval(()=>{w()},3e4);return()=>clearInterval(v)},[]);const w=async()=>{try{const v=new Date,_=new Date(v.getFullYear(),v.getMonth(),1).toISOString().split("T")[0],h=new Date(v.getFullYear(),v.getMonth()+1,0).toISOString().split("T")[0],i=await g(`/api/rm/ebes-score?start_date=${_}&end_date=${h}`);if(i.ok){const u=await i.json();N(u)}const j=await g("/api/rm/analytics");if(j.ok){const u=await j.json();q({total_teams:u.total_teams,total_recruiters:u.total_recruiters,total_active_roles:u.total_active_roles,total_deals:u.total_deals,total_interviews:u.total_interviews})}const U=await g("/api/rm/dropout-requests");if(U.ok){const u=await U.json();D(u.length)}L(!1)}catch(v){console.error("Failed to fetch dashboard data:",v),L(!1)}},I=v=>{switch(v){case"Excellent":return"from-emerald-500 to-green-500";case"Strong":return"from-blue-500 to-indigo-500";case"Average":return"from-yellow-500 to-orange-500";case"At Risk":return"from-red-500 to-pink-500";default:return"from-gray-500 to-slate-500"}};return M?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-800",children:"Dashboard"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Overview of your team's performance this month"})]}),b>0&&e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 rounded-xl shadow-lg p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white/20 backdrop-blur-sm rounded-lg",children:e.jsx(Pe,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-1",children:"Dropout Acknowledgements Needed"}),e.jsxs("p",{className:"text-orange-100",children:["You have ",b," pending dropout ",b===1?"request":"requests"," requiring your acknowledgement"]})]})]}),e.jsx(ye,{to:"/rm/dropouts",className:"px-6 py-3 bg-white text-orange-600 font-semibold rounded-lg hover:bg-orange-50 transition-colors shadow-lg",children:"Review Now"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-500 rounded-2xl shadow-xl p-8 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Your EBES Score"}),e.jsx("p",{className:"text-indigo-100 mb-6",children:"Employee Best Effort Score - Current Month"}),e.jsx(rs,{type:"ebes",score:(d==null?void 0:d.score)||0,label:(d==null?void 0:d.performance_label)||"No Data",className:"text-white mb-4"}),e.jsx("div",{className:`inline-block px-6 py-3 rounded-lg bg-gradient-to-r ${I((d==null?void 0:d.performance_label)||"Average")} text-white font-semibold text-lg shadow-lg`,children:(d==null?void 0:d.performance_label)||"No Data"})]}),e.jsx("div",{className:"w-40 h-40 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center",children:e.jsx(pe,{className:"w-20 h-20 text-white"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-slate-200 p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl flex items-center justify-center",children:e.jsx(ae,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Teams"})]}),e.jsx("p",{className:"text-4xl font-bold text-slate-800",children:(a==null?void 0:a.total_teams)||0}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Under your management"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-slate-200 p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center",children:e.jsx(X,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Recruiters"})]}),e.jsx("p",{className:"text-4xl font-bold text-slate-800",children:(a==null?void 0:a.total_recruiters)||0}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Active team members"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-slate-200 p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-xl flex items-center justify-center",children:e.jsx(ie,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Active Roles"})]}),e.jsx("p",{className:"text-4xl font-bold text-slate-800",children:(a==null?void 0:a.total_active_roles)||0}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Currently being worked"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-slate-200 p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-indigo-500 to-blue-500 rounded-xl flex items-center justify-center",children:e.jsx(ge,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Interviews"})]}),e.jsx("p",{className:"text-4xl font-bold text-slate-800",children:(a==null?void 0:a.total_interviews)||0}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"This month"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-slate-200 p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-xl flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Deals Closed"})]}),e.jsx("p",{className:"text-4xl font-bold text-slate-800",children:(a==null?void 0:a.total_deals)||0}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"This month"})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-slate-50 to-blue-50 border-2 border-indigo-200 rounded-2xl p-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Need Deeper Insights?"}),e.jsx("p",{className:"text-slate-600 mb-4",children:"Access detailed performance analytics, identify underperformers, and get AI-powered corrective action suggestions."}),e.jsxs(ye,{to:"/rm/analytics",className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg font-medium hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg",children:[e.jsx(ge,{className:"w-5 h-5"}),"View Advanced Analytics"]})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx("svg",{className:"w-32 h-32 text-indigo-200",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M3 13h2v8H3v-8zm4-4h2v12H7V9zm4-6h2v18h-2V3zm4 8h2v10h-2V11zm4-2h2v12h-2V9z"})})})]})})]})}function vs(){var ke;const[d,N]=l.useState(!0),[a,q]=l.useState(null),[b,D]=l.useState([]),[M,L]=l.useState([]),[w,I]=l.useState([]),[v,_]=l.useState(!1),[h,i]=l.useState("this_month"),[j,U]=l.useState(""),[u,H]=l.useState(""),[p,A]=l.useState(""),[c,S]=l.useState(""),[P,J]=l.useState(30),[G,Q]=l.useState([]),[m,t]=l.useState([]);l.useEffect(()=>{o()},[]),l.useEffect(()=>{le(),k()},[h,j,u,p,c,P]);const o=async()=>{try{const[s,x]=await Promise.all([g("/api/rm/teams"),g("/api/rm/clients")]);s.ok&&Q(await s.json()),x.ok&&t(await x.json())}catch(s){console.error("Failed to fetch filter options:",s)}},k=async()=>{try{const s=await g(`/api/rm/ebes-history?days=${P}`);if(s.ok){const x=await s.json();D(x)}}catch(s){console.error("Failed to fetch EBES history:",s)}},Y=async s=>{try{await g("/api/rm/ebes-history",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ebes_score:s.rm_ebes_score,ebes_label:s.rm_ebes_label,total_roles:s.total_active_roles+s.total_non_active_roles,total_deals:s.total_deals,total_interviews:s.total_interviews,total_dropouts:s.total_dropouts})})}catch(x){console.error("Failed to save EBES history:",x)}},le=async()=>{N(!0);try{const s=new URLSearchParams;if(h==="custom"&&j&&u)s.append("start_date",j),s.append("end_date",u);else if(h!=="all_time"){const{start:$,end:y}=W(h);s.append("start_date",$),s.append("end_date",y)}p&&s.append("team_id",p),c&&s.append("client_id",c);const x=await g(`/api/rm/analytics-comprehensive?${s.toString()}`);if(x.ok){const $=await x.json();q($),de($),n($),(h==="this_month"||h==="all_time")&&Y($.overview)}}catch(s){console.error("Failed to fetch analytics:",s)}finally{N(!1)}},W=s=>{const x=new Date;let $,y;switch(s){case"this_month":$=new Date(x.getFullYear(),x.getMonth(),1).toISOString().split("T")[0],y=x.toISOString().split("T")[0];break;case"last_month":$=new Date(x.getFullYear(),x.getMonth()-1,1).toISOString().split("T")[0],y=new Date(x.getFullYear(),x.getMonth(),0).toISOString().split("T")[0];break;case"last_3_months":$=new Date(x.getFullYear(),x.getMonth()-3,1).toISOString().split("T")[0],y=x.toISOString().split("T")[0];break;default:$="",y=""}return{start:$,end:y}},oe=s=>{const x=s.interviews_level_2||0,$=s.interviews_level_3||0,y=s.total_deals||0,z=s.total_interviews||1;return z===0?0:(x+$+y)/z*100},de=s=>{const x=[];(s.overview.rm_ebes_score??0)<60?x.push({type:"critical",title:"EBES Score Below Target",description:`Your current EBES score of ${(s.overview.rm_ebes_score??0).toFixed(1)} is in the "${s.overview.rm_ebes_label}" range. Immediate action required.`,metric:`${(s.overview.rm_ebes_score??0).toFixed(1)} / 100`,icon:re}):(s.overview.rm_ebes_score??0)>=90&&x.push({type:"success",title:"Excellent Performance",description:`Outstanding EBES score of ${(s.overview.rm_ebes_score??0).toFixed(1)}. Your team is performing exceptionally well.`,metric:`${(s.overview.rm_ebes_score??0).toFixed(1)} / 100`,icon:te});const $=s.recruiters.filter(r=>(r.recruiter_ebes??0)<60);$.length>0&&x.push({type:"warning",title:"Underperforming Recruiters Identified",description:`${$.length} recruiter(s) with EBES score below 60. Consider targeted coaching.`,metric:`${$.length} recruiter(s)`,icon:X});const y=s.recruiters.filter(r=>(r.recruiter_ebes??0)>=90);y.length>0&&x.push({type:"success",title:"Top Performers",description:`${y.length} recruiter(s) with excellent EBES scores. Consider recognition or mentorship roles.`,metric:`${y.length} recruiter(s)`,icon:te});const z=s.overview.total_deals>0?s.overview.total_dropouts/(s.overview.total_deals+s.overview.total_dropouts)*100:0;z>30&&x.push({type:"warning",title:"High Dropout Rate",description:`Dropout rate of ${z.toFixed(1)}% is concerning. Review candidate quality and client expectations.`,metric:`${z.toFixed(1)}%`,icon:Ae});const C=s.clients.filter(r=>r.health==="At Risk");C.length>0&&x.push({type:"warning",title:"Clients At Risk",description:`${C.length} client(s) flagged as "At Risk". Review engagement and delivery.`,metric:`${C.length} client(s)`,icon:Pe}),L(x)},ve=async(s,x)=>{const $=s.fields&&s.fields.length>0?s.fields:["user_info","ebes_score","cv_quality_average","cv_quality_label","teams","clients","total_roles","active_roles","interviews_1","interviews_2","interviews_3","total_interviews","deals","dropouts","client_breakdown","team_breakdown"],y=new URLSearchParams;if(s.teamId&&s.teamId!=="all"&&y.append("team_id",s.teamId),s.clientId&&s.clientId!=="all"&&y.append("client_id",s.clientId),s.dateRange==="custom"&&s.startDate&&s.endDate)y.append("start_date",s.startDate),y.append("end_date",s.endDate);else if(s.dateRange==="today"){const f=new Date().toISOString().split("T")[0];y.append("start_date",f),y.append("end_date",f)}else if(s.dateRange==="week"){const f=new Date,R=new Date(f.getTime()-10080*60*1e3);y.append("start_date",R.toISOString().split("T")[0]),y.append("end_date",f.toISOString().split("T")[0])}else if(s.dateRange==="month"){const f=new Date,R=new Date(f.getTime()-720*60*60*1e3);y.append("start_date",R.toISOString().split("T")[0]),y.append("end_date",f.toISOString().split("T")[0])}let z=null;try{const f=await g(`/api/rm/analytics-comprehensive?${y.toString()}`);f.ok&&(z=await f.json())}catch{}const C=(z==null?void 0:z.overview)||(a==null?void 0:a.overview)||{total_active_roles:0,total_non_active_roles:0,total_deals:0,total_interviews:0,interviews_level_1:0,interviews_level_2:0,interviews_level_3:0,total_dropouts:0,rm_ebes_score:0,rm_ebes_label:"No Data",cv_quality_average:0,cv_quality_label:""},r=(z==null?void 0:z.teams)||(a==null?void 0:a.teams)||[],K=(z==null?void 0:z.clients)||(a==null?void 0:a.clients)||[],E=localStorage.getItem("user")||"{}";let B="",O="",Z="";try{const f=JSON.parse(E);B=f.name||"",O=f.user_code||"",Z=f.email||""}catch{}const Ne={user_info:["Name","User Code","Email"],ebes_score:["EBES Score","Performance"],cv_quality_average:["CV Quality Avg"],cv_quality_label:["CV Quality Label"],teams:["Teams"],clients:["Clients"],total_roles:["Total Roles"],active_roles:["Active Roles"],interviews_1:["Interview 1"],interviews_2:["Interview 2"],interviews_3:["Interview 3"],total_interviews:["Total Interviews"],deals:["Deals"],dropouts:["Dropouts"],client_breakdown:["Client Breakdown"],team_breakdown:["Team Breakdown"],roles_to_interviews_pct:["Roles → Interviews %"],interviews_to_deals_pct:["Interviews → Deals %"],stage_1_to_2_dropoff_pct:["Stage 1→2 Drop-off %"],stage_2_to_3_dropoff_pct:["Stage 2→3 Drop-off %"],dropout_rate_pct:["Dropout Rate %"]},Re=()=>{const f=[];return $.forEach(R=>{if(R==="user_info")f.push(`"${B}"`,O,Z);else if(R==="ebes_score")f.push(String(C.rm_ebes_score||0),C.rm_ebes_label||"");else if(R==="cv_quality_average")f.push(String(Math.round((C.cv_quality_average||0)*10)/10));else if(R==="cv_quality_label")f.push(C.cv_quality_label||"");else if(R==="teams")f.push(`"${r.map(T=>T.team_name).join("; ")}"`);else if(R==="clients")f.push(`"${K.map(T=>T.client_name).join("; ")}"`);else if(R==="total_roles")f.push(String((C.total_active_roles||0)+(C.total_non_active_roles||0)));else if(R==="active_roles")f.push(String(C.total_active_roles||0));else if(R==="interviews_1")f.push(String(C.interviews_level_1||0));else if(R==="interviews_2")f.push(String(C.interviews_level_2||0));else if(R==="interviews_3")f.push(String(C.interviews_level_3||0));else if(R==="total_interviews")f.push(String(C.total_interviews||0));else if(R==="deals")f.push(String(C.total_deals||0));else if(R==="dropouts")f.push(String(C.total_dropouts||0));else if(R==="client_breakdown"){const T=K.map(F=>`${F.client_name}: roles ${F.total_roles}, interviews ${F.interviews}, deals ${F.deals}, dropouts ${F.dropouts}`).join("; ");f.push(`"${T}"`)}else if(R==="team_breakdown"){const T=r.map(F=>`${F.team_name}: roles ${F.total_roles}, active ${F.active_roles}, interviews ${F.interviews_level_1+F.interviews_level_2+F.interviews_level_3}, deals ${F.deals}, dropouts ${F.dropouts}`).join("; ");f.push(`"${T}"`)}else if(R==="roles_to_interviews_pct"){const T=(C.total_active_roles||0)+(C.total_non_active_roles||0),F=T>0?Math.round((C.total_interviews||0)/T*1e3)/10:0;f.push(String(F))}else if(R==="interviews_to_deals_pct"){const T=C.total_interviews||0,F=T>0?Math.round((C.total_deals||0)/T*1e3)/10:0;f.push(String(F))}else if(R==="stage_1_to_2_dropoff_pct"){const T=C.interviews_level_1||0,F=C.interviews_level_2||0,se=T>0?Math.round((T-F)/T*1e3)/10:0;f.push(String(se))}else if(R==="stage_2_to_3_dropoff_pct"){const T=C.interviews_level_2||0,F=C.interviews_level_3||0,se=T>0?Math.round((T-F)/T*1e3)/10:0;f.push(String(se))}else if(R==="dropout_rate_pct"){const T=C.total_interviews||0,F=T>0?Math.round((C.total_dropouts||0)/T*1e3)/10:0;f.push(String(F))}}),f},we=[];$.forEach(f=>{const R=Ne[f];R&&we.push(...R)});const xe=[];xe.push(`"RM Report - ${new Date().toLocaleDateString()}"`),xe.push(""),xe.push(we.join(",")),xe.push(Re().join(","));const Ce=x==="excel"?"application/vnd.ms-excel;charset=utf-8;":x==="csv"?"text/csv;charset=utf-8;":"text/html";if(x==="pdf"){const f=`<!doctype html><html><head><meta charset="utf-8"><title>RM Report</title></head><body><h2>Recruitment Manager Report</h2><table style="border-collapse:collapse;width:100%"><thead><tr>${we.map(se=>`<th style="padding:8px;border:1px solid #ddd;text-align:left">${se}</th>`).join("")}</tr></thead><tbody><tr>${Re().map(se=>`<td style="padding:8px;border:1px solid #ddd;">${se}</td>`).join("")}</tr></tbody></table></body></html>`,R=new Blob([f],{type:Ce}),T=URL.createObjectURL(R),F=window.open(T);F&&F.addEventListener("load",()=>{F.print()})}else{const f=new Blob([xe.join(`
`)],{type:Ce}),R=URL.createObjectURL(f),T=document.createElement("a");T.href=R,T.download=`rm-report-${new Date().toISOString().split("T")[0]}.csv`,T.click(),URL.revokeObjectURL(R)}},n=s=>{const x=[],$=s.recruiters.filter(r=>(r.recruiter_ebes??0)<60);$.length>0&&$.forEach(r=>{const E=75-(r.recruiter_ebes??0),B=[],O=[];r.submissions<5&&(B.push("very low submission volume"),O.push(`${r.recruiter_name} needs to increase submissions from ${r.submissions} to at least 10-15 per period`)),r.interviews===0?(B.push("no interviews scheduled"),O.push(`Focus on candidate quality - ${r.recruiter_name} has ${r.submissions} submissions but 0 interviews`)):r.submissions>0&&r.interviews/r.submissions<.3&&(B.push("low interview conversion"),O.push(`Review ${r.recruiter_name}'s candidate screening - only ${Math.round(r.interviews/r.submissions*100)}% reaching interview stage`)),r.deals===0&&r.interviews>0&&(B.push("interviews not converting to deals"),O.push(`${r.recruiter_name} has ${r.interviews} interviews but 0 deals - review candidate-role fit assessment`)),r.dropouts>r.deals&&(B.push("high dropout rate"),O.push(`${r.recruiter_name} has ${r.dropouts} dropouts vs ${r.deals} deals - investigate root causes immediately`)),B.length===0&&(B.push("low overall activity"),O.push(`${r.recruiter_name} needs to increase engagement across all metrics`)),O.push(`Set weekly check-ins with ${r.recruiter_name} to track progress`),O.push(`Target: Achieve 75 EBES score (current: ${(r.recruiter_ebes??0).toFixed(1)})`);const Z=s.recruiters.find(Ne=>(Ne.recruiter_ebes??0)>=90);Z&&O.push(`Pair ${r.recruiter_name} with ${Z.recruiter_name} (EBES: ${(Z.recruiter_ebes??0).toFixed(1)}) for shadowing`),x.push({priority:"high",category:"Individual Performance",title:`Improve ${r.recruiter_name}'s Performance`,description:`EBES score ${(r.recruiter_ebes??0).toFixed(1)}/100. Main issues: ${B.join(", ")}.`,steps:O,expected_impact:`Target: 75 EBES score (+${E.toFixed(1)} points) within 30 days`})});const y=s.overview.total_deals>0?s.overview.total_dropouts/(s.overview.total_deals+s.overview.total_dropouts)*100:0;if(y>20){const r=s.recruiters.filter(O=>O.dropouts>O.deals&&O.dropouts>0),K=15,E=[];E.push(`Current team dropout rate: ${y.toFixed(1)}% (${s.overview.total_dropouts} dropouts vs ${s.overview.total_deals} deals)`),r.length>0?(E.push(`High-risk recruiters: ${r.map(O=>`${O.recruiter_name} (${O.dropouts} dropouts, ${O.deals} deals)`).join(", ")}`),E.push("Conduct 1-on-1 reviews with each high-risk recruiter to identify patterns")):E.push("Review all recent dropouts to identify common patterns"),E.push("Analyze dropout reasons: candidate declined offer, failed background check, or client withdrew?"),E.push("Implement pre-submission checklist: candidate commitment level, salary expectations alignment, notice period"),E.push("Schedule weekly pipeline review meetings to catch at-risk placements early");const B=s.clients.reduce((O,Z)=>Z.dropouts>O.dropouts?Z:O,s.clients[0]);B&&B.dropouts>0&&E.push(`Priority client review: ${B.client_name} (${B.dropouts} dropouts) - assess expectations and communication`),x.push({priority:y>30?"high":"medium",category:"Quality & Risk Management",title:"Reduce Dropout Rate Across Team",description:`Dropout rate of ${y.toFixed(1)}% exceeds acceptable levels. Need immediate intervention.`,steps:E,expected_impact:`Target: Reduce dropout rate to ${K}% (saving ~${Math.round((y-K)/100*s.overview.total_dropouts)} placements)`})}const z=s.clients.filter(r=>r.health==="At Risk");z.length>0&&z.forEach(r=>{const K=r.interviews>0?r.deals/r.interviews*100:0,E=[],B=[];r.deals===0&&r.total_roles>3&&(B.push("no deals closed despite multiple roles"),E.push(`${r.client_name} has ${r.total_roles} roles but 0 deals - schedule urgent meeting to review expectations`)),r.dropouts>r.deals&&(B.push("more dropouts than successful placements"),E.push(`${r.client_name}: ${r.dropouts} dropouts vs ${r.deals} deals - assess candidate quality and role requirements`)),K<20&&r.interviews>0&&(B.push("low interview-to-deal conversion"),E.push(`Only ${K.toFixed(1)}% of ${r.client_name}'s interviews convert to deals - review screening process`)),r.interviews===0&&r.total_roles>0&&(B.push("no candidate reaching interview stage"),E.push(`${r.client_name} has ${r.total_roles} roles but 0 interviews - candidate sourcing needs complete overhaul`)),E.push(`Schedule face-to-face meeting with ${r.client_name} stakeholders within 48 hours`),E.push("Prepare detailed performance report showing submission-to-hire funnel"),E.push("Identify and address any misalignment in role requirements or expectations"),E.push(`Assign senior recruiter or account manager as dedicated point of contact for ${r.client_name}`),x.push({priority:"high",category:"Client Relationship",title:`Save ${r.client_name} Account`,description:`Client health: At Risk. ${B.join("; ")}. Immediate action required.`,steps:E,expected_impact:`Restore ${r.client_name} relationship and prevent account loss`})});const C=s.recruiters.filter(r=>(r.recruiter_ebes??0)>=90);if(C.length>0&&$.length>0&&x.push({priority:"low",category:"Team Recognition",title:"Leverage Top Performers for Team Growth",description:`${C.length} recruiter(s) performing excellently. Use them to uplift the team.`,steps:[...C.map(r=>`Recognize ${r.recruiter_name}'s achievement (EBES: ${(r.recruiter_ebes??0).toFixed(1)}, ${r.deals} deals, ${r.submissions} submissions)`),"Establish peer mentorship program pairing top and developing performers","Document and share best practices from high performers","Consider bonus or recognition for consistent excellence"],expected_impact:"Improve team morale and knowledge sharing, raising overall performance"}),$.length===0&&y<20&&z.length===0){const r=s.recruiters.reduce((K,E)=>K+(E.recruiter_ebes??0),0)/Math.max(s.recruiters.length,1);r<80&&x.push({priority:"medium",category:"Team Development",title:"Elevate Overall Team Performance",description:`Team average EBES: ${r.toFixed(1)}. Room for improvement to reach excellence.`,steps:["Conduct skills assessment to identify training needs","Implement weekly best practices sharing sessions","Set team goals for next quarter with individual accountability","Review and optimize role assignment strategy","Introduce performance dashboards for real-time tracking"],expected_impact:`Target: Raise team average EBES from ${r.toFixed(1)} to 80+ within 60 days`})}x.sort((r,K)=>{const E={high:0,medium:1,low:2};return E[r.priority]-E[K.priority]}),I(x)},V=s=>{switch(s){case"high":return"bg-red-100 text-red-700 border-red-300";case"medium":return"bg-yellow-100 text-yellow-700 border-yellow-300";case"low":return"bg-blue-100 text-blue-700 border-blue-300";default:return"bg-gray-100 text-gray-700 border-gray-300"}},ce=s=>{switch(s){case"critical":return"bg-red-50 border-red-300";case"warning":return"bg-yellow-50 border-yellow-300";case"success":return"bg-emerald-50 border-emerald-300";case"info":return"bg-blue-50 border-blue-300";default:return"bg-gray-50 border-gray-300"}},me=s=>{switch(s){case"critical":return"text-red-600";case"warning":return"text-yellow-600";case"success":return"text-emerald-600";case"info":return"text-blue-600";default:return"text-gray-600"}};return d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Qe,{isOpen:v,onClose:()=>_(!1),teams:G.map(s=>({id:s.id,name:s.name,team_code:s.team_code})),clients:m.map(s=>({id:s.id,name:s.name,client_code:s.client_code})),onDownload:ve,allowedRoles:["recruitment_manager","recruiter"]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-800",children:"Advanced Analytics"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Performance insights and corrective action recommendations"})]}),e.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-all font-medium shadow-lg",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Download Report"]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Be,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Filters"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Date Range"}),e.jsxs("select",{value:h,onChange:s=>i(s.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"this_month",children:"This Month"}),e.jsx("option",{value:"last_month",children:"Last Month"}),e.jsx("option",{value:"last_3_months",children:"Last 3 Months"}),e.jsx("option",{value:"custom",children:"Custom Range"}),e.jsx("option",{value:"all_time",children:"All Time"})]})]}),h==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Start Date"}),e.jsx("input",{type:"date",value:j,onChange:s=>U(s.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"End Date"}),e.jsx("input",{type:"date",value:u,onChange:s=>H(s.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Team"}),e.jsxs("select",{value:p,onChange:s=>A(s.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"All Teams"}),G.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Client"}),e.jsxs("select",{value:c,onChange:s=>S(s.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"All Clients"}),m.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]})]}),(a==null?void 0:a.overview)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border-l-4 border-blue-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(X,{className:"w-8 h-8 text-blue-500"}),e.jsx("span",{className:"text-2xl font-bold text-slate-800",children:a.overview.total_recruiters})]}),e.jsx("p",{className:"text-slate-600 text-sm font-medium",children:"Active Recruiters"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border-l-4 border-indigo-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ae,{className:"w-8 h-8 text-indigo-500"}),e.jsx("span",{className:"text-2xl font-bold text-slate-800",children:a.overview.total_active_roles})]}),e.jsx("p",{className:"text-slate-600 text-sm font-medium",children:"Active Roles"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border-l-4 border-purple-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Xe,{className:"w-8 h-8 text-purple-500"}),e.jsx("span",{className:"text-2xl font-bold text-slate-800",children:a.overview.total_interviews})]}),e.jsx("p",{className:"text-slate-600 text-sm font-medium",children:"Total Interviews"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border-l-4 border-emerald-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(te,{className:"w-8 h-8 text-emerald-500"}),e.jsx("span",{className:"text-2xl font-bold text-slate-800",children:a.overview.total_deals})]}),e.jsx("p",{className:"text-slate-600 text-sm font-medium",children:"Total Deals"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border-l-4 border-teal-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(pe,{className:"w-8 h-8 text-teal-500"}),e.jsxs("span",{className:"text-2xl font-bold text-slate-800",children:[oe(a.overview).toFixed(1),"%"]})]}),e.jsx("p",{className:"text-slate-600 text-sm font-medium",children:"Interview Success"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border-l-4 border-orange-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(re,{className:"w-8 h-8 text-orange-500"}),e.jsxs("span",{className:"text-2xl font-bold text-slate-800",children:[(a.overview.cv_quality_average??0).toFixed(1),"%"]})]}),e.jsx("p",{className:"text-slate-600 text-sm font-medium",children:"CV Quality"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:a.overview.cv_quality_label??"N/A"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border-l-4 border-red-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(re,{className:"w-8 h-8 text-red-500"}),e.jsx("span",{className:"text-2xl font-bold text-slate-800",children:a.overview.total_dropouts})]}),e.jsx("p",{className:"text-slate-600 text-sm font-medium",children:"Total Dropouts"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border-l-4 border-indigo-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(te,{className:"w-8 h-8 text-indigo-500"}),e.jsx("span",{className:"text-2xl font-bold text-slate-800",children:(a.overview.rm_ebes_score??0).toFixed(1)})]}),e.jsx("p",{className:"text-slate-600 text-sm font-medium",children:"RM EBES"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:a.overview.rm_ebes_label})]})]}),(a==null?void 0:a.dropout_reasons)&&a.dropout_reasons.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-xl flex items-center justify-center",children:e.jsx(Ae,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Dropout Reasons"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Distribution of recorded reasons"})]})]}),e.jsx("div",{style:{width:"100%",height:260},children:e.jsx($e,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:a.dropout_reasons,children:[e.jsx(Te,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(De,{dataKey:"reason",tick:{fontSize:12},stroke:"#64748b"}),e.jsx(Ee,{stroke:"#64748b",tick:{fontSize:12}}),e.jsx(Fe,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"12px"}}),e.jsx(Me,{}),e.jsx(We,{dataKey:"count",name:"Count",fill:"#ef4444"})]})})})]}),b.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl flex items-center justify-center",children:e.jsx(gs,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"EBES Score History"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Track your performance over time"})]})]}),e.jsxs("select",{value:P,onChange:s=>J(parseInt(s.target.value)),className:"px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:7,children:"Last 7 Days"}),e.jsx("option",{value:14,children:"Last 14 Days"}),e.jsx("option",{value:30,children:"Last 30 Days"}),e.jsx("option",{value:90,children:"Last 90 Days"})]})]}),e.jsx($e,{width:"100%",height:300,children:e.jsxs(os,{data:b,children:[e.jsx(Te,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(De,{dataKey:"recorded_at",stroke:"#64748b",tick:{fontSize:12},tickFormatter:s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(Ee,{stroke:"#64748b",tick:{fontSize:12},domain:[0,100]}),e.jsx(Fe,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"12px"},labelFormatter:s=>new Date(s).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),e.jsx(Me,{}),e.jsx(is,{type:"monotone",dataKey:"ebes_score",stroke:"#6366f1",strokeWidth:3,dot:{fill:"#6366f1",r:4},activeDot:{r:6},name:"EBES Score"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-blue-600 mb-1",children:"Current Score"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:(((ke=b[b.length-1])==null?void 0:ke.ebes_score)??0).toFixed(1)})]}),e.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-emerald-600 mb-1",children:"Highest Score"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-700",children:Math.max(...b.map(s=>s.ebes_score??0)).toFixed(1)})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-600 mb-1",children:"Average Score"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-700",children:(b.reduce((s,x)=>s+(x.ebes_score??0),0)/Math.max(b.length,1)).toFixed(1)})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-purple-600 mb-1",children:"Trend"}),e.jsx("div",{className:"flex items-center justify-center gap-2",children:b.length>=2&&b[b.length-1].ebes_score>b[b.length-2].ebes_score?e.jsxs(e.Fragment,{children:[e.jsx(us,{className:"w-6 h-6 text-emerald-600"}),e.jsx("span",{className:"text-xl font-bold text-emerald-600",children:"Up"})]}):e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"w-6 h-6 text-red-600"}),e.jsx("span",{className:"text-xl font-bold text-red-600",children:"Down"})]})})]})]})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Recruiter Performance Breakdown"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-slate-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700",children:"Recruiter"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-slate-700",children:"Submissions"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-slate-700",children:"Interviews"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-slate-700",children:"Deals"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-slate-700",children:"Dropouts"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-slate-700",children:"EBES Score"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-slate-700",children:"Performance"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-slate-700",children:"CV Quality"})]})}),e.jsx("tbody",{children:a.recruiters.sort((s,x)=>x.recruiter_ebes-s.recruiter_ebes).map(s=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-800",children:s.recruiter_name}),e.jsx("p",{className:"text-sm text-slate-500",children:s.recruiter_code})]})}),e.jsx("td",{className:"text-right py-3 px-4 font-semibold text-slate-800",children:s.submissions}),e.jsx("td",{className:"text-right py-3 px-4 text-indigo-600 font-semibold",children:s.interviews}),e.jsx("td",{className:"text-right py-3 px-4 text-emerald-600 font-semibold",children:s.deals}),e.jsx("td",{className:"text-right py-3 px-4 text-red-600 font-semibold",children:s.dropouts}),e.jsx("td",{className:"text-right py-3 px-4",children:e.jsx("div",{className:"flex flex-col items-end",children:e.jsx("span",{className:`font-bold text-xl ${(s.recruiter_ebes??0)>=90?"text-emerald-600":(s.recruiter_ebes??0)>=75?"text-blue-600":(s.recruiter_ebes??0)>=60?"text-yellow-600":"text-red-600"}`,children:(s.recruiter_ebes??0).toFixed(1)})})}),e.jsx("td",{className:"text-center py-3 px-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${s.recruiter_ebes_label==="Excellent"?"bg-emerald-100 text-emerald-700":s.recruiter_ebes_label==="Strong"?"bg-blue-100 text-blue-700":s.recruiter_ebes_label==="Average"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:s.recruiter_ebes_label})}),e.jsxs("td",{className:"text-center py-3 px-4",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-800",children:[(s.cv_quality_average??0).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-slate-500",children:s.cv_quality_label??"N/A"})]})]},s.recruiter_id))})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Team Performance Analysis"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-slate-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700",children:"Team"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-slate-700",children:"Total Roles"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-slate-700",children:"Active"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-slate-700",children:"Deals"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-slate-700",children:"Dropouts"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-slate-700",children:"Conversion %"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-slate-700",children:"CV Quality"})]})}),e.jsx("tbody",{children:a.teams.map(s=>{const x=s.total_roles>0?s.deals/s.total_roles*100:0;return e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-800",children:s.team_name}),e.jsx("p",{className:"text-sm text-slate-500",children:s.team_code})]})}),e.jsx("td",{className:"text-right py-3 px-4 font-semibold text-slate-800",children:s.total_roles}),e.jsx("td",{className:"text-right py-3 px-4 text-emerald-600 font-semibold",children:s.active_roles}),e.jsx("td",{className:"text-right py-3 px-4 text-yellow-600 font-semibold",children:s.deals}),e.jsx("td",{className:"text-right py-3 px-4 text-red-600 font-semibold",children:s.dropouts}),e.jsx("td",{className:"text-right py-3 px-4",children:e.jsxs("span",{className:`font-bold ${x>=25?"text-emerald-600":x>=15?"text-blue-600":x>=10?"text-yellow-600":"text-red-600"}`,children:[x.toFixed(1),"%"]})}),e.jsxs("td",{className:"text-center py-3 px-4",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-800",children:[(s.cv_quality_average??0).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-slate-500",children:s.cv_quality_label??"N/A"})]})]},s.team_id)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Client Impact on Performance"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-slate-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700",children:"Client"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-slate-700",children:"Roles"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-slate-700",children:"Interviews"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-slate-700",children:"Deals"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-slate-700",children:"Dropouts"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-slate-700",children:"Health"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-slate-700",children:"CV Quality"})]})}),e.jsx("tbody",{children:a.clients.map(s=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-800",children:s.client_name}),e.jsx("p",{className:"text-sm text-slate-500",children:s.client_code})]})}),e.jsx("td",{className:"text-right py-3 px-4 font-semibold text-slate-800",children:s.total_roles}),e.jsx("td",{className:"text-right py-3 px-4 text-indigo-600 font-semibold",children:s.interviews}),e.jsx("td",{className:"text-right py-3 px-4 text-emerald-600 font-semibold",children:s.deals}),e.jsx("td",{className:"text-right py-3 px-4 text-red-600 font-semibold",children:s.dropouts}),e.jsx("td",{className:"text-center py-3 px-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${s.health==="Strong"?"bg-emerald-100 text-emerald-700":s.health==="At Risk"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:s.health})}),e.jsxs("td",{className:"text-center py-3 px-4",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-800",children:[(s.cv_quality_average??0).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-slate-500",children:s.cv_quality_label??"N/A"})]})]},s.client_id))})]})})]})]}),M.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center",children:e.jsx(Oe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Performance Insights"}),e.jsx("p",{className:"text-sm text-slate-500",children:"AI-powered analysis of your team's performance"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:M.map((s,x)=>{const $=s.icon;return e.jsx("div",{className:`border-2 rounded-xl p-5 ${ce(s.type)}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`flex-shrink-0 ${me(s.type)}`,children:e.jsx($,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-slate-800 mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-slate-600 mb-2",children:s.description}),e.jsx("div",{className:"inline-block px-3 py-1 bg-white/50 rounded-lg",children:e.jsx("span",{className:"text-sm font-semibold text-slate-700",children:s.metric})})]})]})},x)})})]}),w.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl shadow-lg border-2 border-indigo-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(Ze,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800",children:"Recommended Corrective Actions"}),e.jsx("p",{className:"text-sm text-slate-600",children:"AI-generated action plan based on current performance data"})]})]}),e.jsx("div",{className:"space-y-4",children:w.map((s,x)=>e.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-slate-200 p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold uppercase border-2 ${V(s.priority)}`,children:[s.priority," Priority"]}),e.jsx("span",{className:"text-xs font-medium text-slate-500",children:s.category})]}),e.jsx("h4",{className:"text-lg font-bold text-slate-800 mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-slate-600",children:s.description})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-bold text-slate-700 mb-2",children:"Action Steps:"}),e.jsx("ul",{className:"space-y-2",children:s.steps.map(($,y)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-indigo-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-slate-700",children:$})]},y))})]}),e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"text-sm font-semibold text-indigo-800",children:"Expected Impact:"})]}),e.jsx("p",{className:"text-sm text-indigo-700 mt-1",children:s.expected_impact})]})]},x))})]})]})}function Ns({isOpen:d,onClose:N,onSuccess:a}){const[q,b]=l.useState([]),[D,M]=l.useState([]),[L,w]=l.useState([]),[I,v]=l.useState([]),[_,h]=l.useState(!1),[i,j]=l.useState({client_id:"",team_ids:[],title:"",description:"",account_manager_id:"",recruiter_ids:[]});l.useEffect(()=>{d&&U()},[d]);const U=async()=>{try{const[c,S,P,J]=await Promise.all([g("/api/rm/clients"),g("/api/rm/teams"),g("/api/rm/account-managers"),g("/api/rm/recruiters")]);c.ok&&b(await c.json()),S.ok&&M(await S.json()),P.ok&&w(await P.json()),J.ok&&v(await J.json())}catch(c){console.error("Failed to fetch initial data:",c)}},u=c=>{j(S=>({...S,team_ids:S.team_ids.includes(c)?S.team_ids.filter(P=>P!==c):[...S.team_ids,c]}))},H=c=>{j(S=>({...S,recruiter_ids:S.recruiter_ids.includes(c)?S.recruiter_ids.filter(P=>P!==c):[...S.recruiter_ids,c]}))},p=async c=>{if(c.preventDefault(),!i.client_id||i.team_ids.length===0||!i.title||!i.account_manager_id){alert("Please fill in all required fields and select at least one team");return}h(!0);try{const S=await g("/api/rm/roles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:parseInt(i.client_id),team_ids:i.team_ids,title:i.title,description:i.description,account_manager_id:parseInt(i.account_manager_id)})});if(S.ok){const J=(await S.json()).role_id;i.recruiter_ids.length>0&&await g(`/api/rm/roles/${J}/recruiters`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recruiter_ids:i.recruiter_ids})}),a(),A()}else{const P=await S.json();alert(P.error||"Failed to create role")}}catch(S){console.error("Error creating role:",S),alert("Failed to create role")}finally{h(!1)}},A=()=>{j({client_id:"",team_ids:[],title:"",description:"",account_manager_id:"",recruiter_ids:[]}),N()};return d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-indigo-600 to-indigo-700 px-8 py-6 flex items-center justify-between text-white z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 rounded-xl p-2",children:e.jsx(ae,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Create New Role"}),e.jsx("p",{className:"text-indigo-100 text-sm mt-0.5",children:"Add a new role and assign to teams"})]})]}),e.jsx("button",{onClick:A,className:"text-white hover:bg-white/20 rounded-full p-2 transition-colors",children:e.jsx(ne,{className:"w-6 h-6"})})]}),e.jsx("form",{onSubmit:p,className:"p-8 overflow-y-auto max-h-[calc(90vh-180px)]",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:["Role Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:i.title,onChange:c=>j({...i,title:c.target.value}),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all",placeholder:"e.g., Senior Software Engineer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Description"}),e.jsx("textarea",{value:i.description,onChange:c=>j({...i,description:c.target.value}),rows:3,className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all resize-none",placeholder:"Optional role description..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:[e.jsx(je,{className:"w-4 h-4 inline mr-1"}),"Client ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:i.client_id,onChange:c=>j({...i,client_id:c.target.value}),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all appearance-none bg-white",children:[e.jsx("option",{value:"",children:"Select a client"}),q.map(c=>e.jsxs("option",{value:c.id,children:[c.name," (",c.client_code,")"]},c.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:[e.jsx(X,{className:"w-4 h-4 inline mr-1"}),"Assign to Teams ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"Select one or more teams for this role"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto border border-slate-200 rounded-xl p-4",children:D.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"No teams available"}):D.map(c=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${i.team_ids.includes(c.id)?"border-indigo-500 bg-indigo-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",checked:i.team_ids.includes(c.id),onChange:()=>u(c.id),className:"w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-800",children:c.name}),e.jsx("p",{className:"text-sm text-slate-500 font-mono",children:c.team_code})]})]},c.id))}),i.team_ids.length>0&&e.jsxs("p",{className:"text-sm text-indigo-600 mt-2",children:[i.team_ids.length," team",i.team_ids.length!==1?"s":""," selected"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),"Account Manager ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:i.account_manager_id,onChange:c=>j({...i,account_manager_id:c.target.value}),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all appearance-none bg-white",children:[e.jsx("option",{value:"",children:"Select an account manager"}),L.map(c=>e.jsxs("option",{value:c.id,children:[c.name," (",c.user_code,")"]},c.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:[e.jsx(X,{className:"w-4 h-4 inline mr-1"}),"Assign to Recruiters (Optional)"]}),e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"Select recruiters to work on this role"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto border border-slate-200 rounded-xl p-4",children:I.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"No recruiters available"}):I.map(c=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${i.recruiter_ids.includes(c.id)?"border-emerald-500 bg-emerald-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",checked:i.recruiter_ids.includes(c.id),onChange:()=>H(c.id),className:"w-5 h-5 text-emerald-600 rounded focus:ring-2 focus:ring-emerald-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-800",children:c.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm text-slate-500 font-mono",children:c.user_code}),c.team_name&&e.jsxs("span",{className:"text-xs text-slate-400",children:["• ",c.team_name]})]})]})]},c.id))}),i.recruiter_ids.length>0&&e.jsxs("p",{className:"text-sm text-emerald-600 mt-2",children:[i.recruiter_ids.length," recruiter",i.recruiter_ids.length!==1?"s":""," selected"]})]})]})}),e.jsxs("div",{className:"sticky bottom-0 bg-slate-50 border-t border-slate-200 px-8 py-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:A,className:"flex-1 px-6 py-3 bg-slate-200 text-slate-700 rounded-xl hover:bg-slate-300 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:p,disabled:_,className:"flex-1 px-6 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:_?"Creating...":"Create Role"})]})]})}):null}function ws({isOpen:d,role:N,onClose:a,onSuccess:q}){const[b,D]=l.useState([]),[M,L]=l.useState([]),[w,I]=l.useState([]),[v,_]=l.useState([]),[h,i]=l.useState([]),[j,U]=l.useState([]),[u,H]=l.useState(!1),[p,A]=l.useState({client_id:"",team_ids:[],title:"",description:"",account_manager_id:"",recruiter_ids:[]});l.useEffect(()=>{d&&N&&(c(),S(),P(),A({client_id:String(N.client_id),team_ids:[],title:N.title,description:N.description||"",account_manager_id:String(N.account_manager_id),recruiter_ids:[]}))},[d,N]);const c=async()=>{try{const[t,o,k,Y]=await Promise.all([g("/api/rm/clients"),g("/api/rm/teams"),g("/api/rm/account-managers"),g("/api/rm/recruiters")]);t.ok&&D(await t.json()),o.ok&&L(await o.json()),k.ok&&I(await k.json()),Y.ok&&_(await Y.json())}catch(t){console.error("Failed to fetch initial data:",t)}},S=async()=>{if(N)try{const t=await g(`/api/rm/roles/${N.id}/teams`);if(t.ok){const k=(await t.json()).map(Y=>Y.id);i(k),A(Y=>({...Y,team_ids:k}))}}catch(t){console.error("Failed to fetch role teams:",t)}},P=async()=>{if(N)try{const t=await g(`/api/rm/roles/${N.id}/assigned-recruiters`);if(t.ok){const k=(await t.json()).map(Y=>Y.id);U(k),A(Y=>({...Y,recruiter_ids:k}))}}catch(t){console.error("Failed to fetch assigned recruiters:",t)}},J=t=>{A(o=>({...o,team_ids:o.team_ids.includes(t)?o.team_ids.filter(k=>k!==t):[...o.team_ids,t]}))},G=t=>{A(o=>({...o,recruiter_ids:o.recruiter_ids.includes(t)?o.recruiter_ids.filter(k=>k!==t):[...o.recruiter_ids,t]}))},Q=async t=>{if(t.preventDefault(),!p.client_id||p.team_ids.length===0||!p.title||!p.account_manager_id||!N){alert("Please fill in all required fields and select at least one team");return}H(!0);try{const o=await g(`/api/rm/roles/${N.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:parseInt(p.client_id),team_ids:p.team_ids,title:p.title,description:p.description,account_manager_id:parseInt(p.account_manager_id)})});if(o.ok)await g(`/api/rm/roles/${N.id}/recruiters`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recruiter_ids:p.recruiter_ids})}),q(),m();else{const k=await o.json();alert(k.error||"Failed to update role")}}catch(o){console.error("Error updating role:",o),alert("Failed to update role")}finally{H(!1)}},m=()=>{A({client_id:"",team_ids:[],title:"",description:"",account_manager_id:"",recruiter_ids:[]}),i([]),U([]),a()};return!d||!N?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-indigo-600 to-indigo-700 px-8 py-6 flex items-center justify-between text-white z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 rounded-xl p-2",children:e.jsx(ae,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Edit Role"}),e.jsx("p",{className:"text-indigo-100 text-sm mt-0.5 font-mono",children:N.role_code})]})]}),e.jsx("button",{onClick:m,className:"text-white hover:bg-white/20 rounded-full p-2 transition-colors",children:e.jsx(ne,{className:"w-6 h-6"})})]}),e.jsx("form",{onSubmit:Q,className:"p-8 overflow-y-auto max-h-[calc(90vh-180px)]",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:["Role Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:p.title,onChange:t=>A({...p,title:t.target.value}),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all",placeholder:"e.g., Senior Software Engineer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Description"}),e.jsx("textarea",{value:p.description,onChange:t=>A({...p,description:t.target.value}),rows:3,className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all resize-none",placeholder:"Optional role description..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:[e.jsx(je,{className:"w-4 h-4 inline mr-1"}),"Client ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:p.client_id,onChange:t=>A({...p,client_id:t.target.value}),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all appearance-none bg-white",children:[e.jsx("option",{value:"",children:"Select a client"}),b.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.client_code,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:[e.jsx(X,{className:"w-4 h-4 inline mr-1"}),"Assign to Teams ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"A role can be assigned to multiple teams"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto border border-slate-200 rounded-xl p-4",children:M.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"No teams available"}):M.map(t=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${p.team_ids.includes(t.id)?"border-indigo-500 bg-indigo-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",checked:p.team_ids.includes(t.id),onChange:()=>J(t.id),className:"w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-800",children:t.name}),e.jsx("p",{className:"text-sm text-slate-500 font-mono",children:t.team_code})]}),h.includes(t.id)&&e.jsx("span",{className:"text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded-full font-medium",children:"Currently Assigned"})]},t.id))}),p.team_ids.length>0&&e.jsxs("p",{className:"text-sm text-indigo-600 mt-2",children:[p.team_ids.length," team",p.team_ids.length!==1?"s":""," selected"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),"Account Manager ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:p.account_manager_id,onChange:t=>A({...p,account_manager_id:t.target.value}),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all appearance-none bg-white",children:[e.jsx("option",{value:"",children:"Select an account manager"}),w.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.user_code,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:[e.jsx(X,{className:"w-4 h-4 inline mr-1"}),"Assign to Recruiters (Optional)"]}),e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"Select recruiters to work on this role"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto border border-slate-200 rounded-xl p-4",children:v.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"No recruiters available"}):v.map(t=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${p.recruiter_ids.includes(t.id)?"border-emerald-500 bg-emerald-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",checked:p.recruiter_ids.includes(t.id),onChange:()=>G(t.id),className:"w-5 h-5 text-emerald-600 rounded focus:ring-2 focus:ring-emerald-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-800",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm text-slate-500 font-mono",children:t.user_code}),t.team_name&&e.jsxs("span",{className:"text-xs text-slate-400",children:["• ",t.team_name]})]})]}),j.includes(t.id)&&e.jsx("span",{className:"text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded-full font-medium",children:"Currently Assigned"})]},t.id))}),p.recruiter_ids.length>0&&e.jsxs("p",{className:"text-sm text-emerald-600 mt-2",children:[p.recruiter_ids.length," recruiter",p.recruiter_ids.length!==1?"s":""," selected"]})]})]})}),e.jsxs("div",{className:"sticky bottom-0 bg-slate-50 border-t border-slate-200 px-8 py-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:m,className:"flex-1 px-6 py-3 bg-slate-200 text-slate-700 rounded-xl hover:bg-slate-300 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Q,disabled:u,className:"flex-1 px-6 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Saving...":"Save Changes"})]})]})})}function ys({isOpen:d,onClose:N,onSuccess:a}){const[q,b]=l.useState([]),[D,M]=l.useState([]),[L,w]=l.useState([]),[I,v]=l.useState(""),[_,h]=l.useState([""]),[i,j]=l.useState(!1),[U,u]=l.useState(!1),[H,p]=l.useState(!1);l.useEffect(()=>{d&&A()},[d]);const A=async()=>{u(!0);try{const[m,t,o]=await Promise.all([g("/api/rm/roles?status=active"),g("/api/rm/recruiters"),g("/api/rm/recruiter-assignments")]);if(m.ok){const k=await m.json();b(k)}if(t.ok){const k=await t.json();M(k)}if(o.ok){const k=await o.json();w(k)}}catch(m){console.error("Failed to fetch data:",m)}finally{u(!1)}},c=()=>{h([..._,""])},S=m=>{_.length>1&&h(_.filter((t,o)=>o!==m))},P=(m,t)=>{const o=[..._];o[m]=t,h(o)},J=async()=>{if(!I){alert("Please select a role");return}let m=[];if(i?m=D.map(t=>String(t.id)):m=_.filter(t=>t!==""),m.length===0){alert('Please select at least one recruiter or enable "Assign to All"');return}p(!0);try{const t=m.map(Y=>g("/api/rm/assign-recruiter-to-role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role_id:parseInt(I),recruiter_id:parseInt(Y)})})),o=await Promise.all(t);if(o.every(Y=>Y.ok))v(""),h([""]),j(!1),await A(),a();else{const le=(await Promise.all(o.map(async(W,oe)=>{if(!W.ok){const de=await W.json();return`Recruiter ${oe+1}: ${de.error||"Failed"}`}return null}))).filter(W=>W!==null).join(`
`);alert(`Some assignments failed:
${le}`),await A()}}catch(t){console.error("Error assigning recruiters:",t),alert("Failed to assign recruiters")}finally{p(!1)}},G=async m=>{if(confirm("Are you sure you want to remove this assignment?"))try{const t=await g(`/api/rm/recruiter-assignments/${m}`,{method:"DELETE"});if(t.ok)await A(),a();else{const o=await t.json();alert(o.error||"Failed to remove assignment")}}catch(t){console.error("Error removing assignment:",t),alert("Failed to remove assignment")}},Q=()=>{v(""),h([""]),j(!1),N()};return d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-emerald-600 to-emerald-700 px-8 py-6 flex items-center justify-between text-white z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 rounded-xl p-2",children:e.jsx(Se,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Assign to Recruiter"}),e.jsx("p",{className:"text-emerald-100 text-sm mt-0.5",children:"Assign active roles to recruiters for active work tracking"})]})]}),e.jsx("button",{onClick:Q,className:"text-white hover:bg-white/20 rounded-full p-2 transition-colors",children:e.jsx(ne,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-8 overflow-y-auto max-h-[calc(90vh-200px)]",children:U?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-emerald-600 border-t-transparent"})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-white border-2 border-emerald-200 rounded-2xl p-6",children:[e.jsxs("h4",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-emerald-600"}),"Create New Assignment"]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:[e.jsx(ae,{className:"w-4 h-4 inline mr-1"}),"Select Role ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:I,onChange:m=>v(m.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all appearance-none bg-white",children:[e.jsx("option",{value:"",children:"Select an active role"}),q.map(m=>e.jsxs("option",{value:m.id,children:[m.role_code," - ",m.title," (",m.client_name,")"]},m.id))]}),q.length===0&&e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"No active roles available"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),"Select Recruiter(s) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:m=>j(m.target.checked),className:"w-4 h-4 text-emerald-600 border-gray-300 rounded focus:ring-emerald-500"}),e.jsx("span",{className:"text-sm font-semibold text-emerald-700",children:"Assign to All"})]})]}),i?e.jsx("div",{className:"bg-emerald-50 border-2 border-emerald-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-emerald-100 rounded-lg p-2 mt-0.5",children:e.jsx(X,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-emerald-900 mb-1",children:"Assigning to All Recruiters"}),e.jsxs("p",{className:"text-sm text-emerald-700 mb-2",children:["This role will be assigned to all ",D.length," available recruiter",D.length!==1?"s":"","."]}),e.jsx("div",{className:"bg-white rounded-lg p-3 max-h-32 overflow-y-auto",children:e.jsx("div",{className:"space-y-1.5",children:D.map(m=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-emerald-500 rounded-full"}),e.jsx("span",{className:"font-medium text-slate-700",children:m.name}),e.jsxs("span",{className:"text-slate-500",children:["(",m.user_code,")"]}),m.team_name&&e.jsxs("span",{className:"text-xs text-slate-400",children:["- ",m.team_name]})]},m.id))})})]})]})}):e.jsxs(e.Fragment,{children:[_.map((m,t)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:m,onChange:o=>P(t,o.target.value),className:"flex-1 px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all appearance-none bg-white",children:[e.jsx("option",{value:"",children:"Select a recruiter"}),D.map(o=>e.jsxs("option",{value:o.id,children:[o.name," (",o.user_code,")",o.team_name?` - ${o.team_name}`:""]},o.id))]}),_.length>1&&e.jsx("button",{onClick:()=>S(t),className:"px-3 py-2 bg-red-100 text-red-700 rounded-xl hover:bg-red-200 transition-colors",title:"Remove this recruiter slot",children:e.jsx(Ue,{className:"w-5 h-5"})})]},t)),D.length===0&&e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"No recruiters available"}),e.jsxs("button",{onClick:c,disabled:D.length===0,className:"w-full px-4 py-3 border-2 border-dashed border-emerald-300 text-emerald-700 rounded-xl hover:bg-emerald-50 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5"}),"Add Another Recruiter"]})]})]}),e.jsxs("button",{onClick:J,disabled:H||!I||!i&&_.filter(m=>m!=="").length===0,className:"w-full px-6 py-3 bg-emerald-600 text-white rounded-xl hover:bg-emerald-700 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 mt-6",children:[e.jsx(ue,{className:"w-5 h-5"}),H?"Assigning...":i?`Assign to All ${D.length} Recruiter(s)`:`Assign ${_.filter(m=>m!=="").length} Recruiter(s) to Role`]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-slate-800 mb-4",children:"Current Assignments"}),L.length===0?e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-8 text-center border-2 border-dashed border-slate-200",children:[e.jsx(Se,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500",children:"No assignments yet. Create your first assignment above."})]}):e.jsx("div",{className:"space-y-3",children:L.map(m=>e.jsxs("div",{className:"bg-white border-2 border-slate-200 rounded-xl p-4 hover:border-emerald-300 hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Role"}),e.jsxs("p",{className:"font-semibold text-slate-800",children:[m.role_code," - ",m.role_title]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Recruiter"}),e.jsxs("p",{className:"font-semibold text-slate-800",children:[m.recruiter_name," (",m.recruiter_code,")"]})]})]}),e.jsx("button",{onClick:()=>G(m.id),className:"ml-4 px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 font-medium text-sm transition-colors",children:"Remove"})]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-2",children:["Assigned: ",new Date(m.assigned_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]},m.id))})]})]})}),e.jsx("div",{className:"sticky bottom-0 bg-slate-50 border-t border-slate-200 px-8 py-4",children:e.jsx("button",{onClick:Q,className:"w-full px-6 py-3 bg-slate-200 text-slate-700 rounded-xl hover:bg-slate-300 font-medium transition-colors",children:"Close"})})]})}):null}function _s(){const[d,N]=l.useState([]),[a,q]=l.useState([]),[b,D]=l.useState([]),[M,L]=l.useState(!0),[w,I]=l.useState(""),[v,_]=l.useState(""),[h,i]=l.useState(""),[j,U]=l.useState(""),[u,H]=l.useState(null),[p,A]=l.useState(!1),[c,S]=l.useState(!1),[P,J]=l.useState(!1),[G,Q]=l.useState(null);l.useEffect(()=>{m()},[]),l.useEffect(()=>{t()},[w,v,h]);const m=async()=>{try{const[n,V]=await Promise.all([g("/api/rm/clients"),g("/api/rm/teams")]);n.ok&&q(await n.json()),V.ok&&D(await V.json())}catch(n){console.error("Failed to fetch initial data:",n)}},t=async()=>{try{L(!0);const n=new URLSearchParams;w==="active"?n.append("status","active"):w==="non-active"&&n.append("status","non-active"),v&&n.append("client_id",v),h&&n.append("team_id",h);const V=await g(`/api/rm/roles?${n.toString()}`);if(V.ok){const ce=await V.json();N(ce)}}catch(n){console.error("Failed to fetch roles:",n)}finally{L(!1)}},o=d.filter(n=>n.title.toLowerCase().includes(j.toLowerCase())||n.role_code.toLowerCase().includes(j.toLowerCase())||n.client_name.toLowerCase().includes(j.toLowerCase())||n.team_name.toLowerCase().includes(j.toLowerCase())),k={total:d.length,active:d.filter(n=>n.status==="active").length,deals:d.filter(n=>n.status==="deal").length,lost:d.filter(n=>n.status==="lost").length,on_hold:d.filter(n=>n.status==="on_hold").length,no_answer:d.filter(n=>n.status==="no_answer").length},Y=n=>{const V={active:{color:"text-emerald-700",bg:"bg-emerald-50 border-emerald-200",icon:ie,label:"Active"},deal:{color:"text-blue-700",bg:"bg-blue-50 border-blue-200",icon:ge,label:"Deal Closed"},lost:{color:"text-red-700",bg:"bg-red-50 border-red-200",icon:he,label:"Lost"},on_hold:{color:"text-yellow-700",bg:"bg-yellow-50 border-yellow-200",icon:Ie,label:"On Hold"},no_answer:{color:"text-orange-700",bg:"bg-orange-50 border-orange-200",icon:he,label:"No Answer"},cancelled:{color:"text-gray-700",bg:"bg-gray-50 border-gray-200",icon:he,label:"Cancelled"}};return V[n]||V.active},le=()=>{I(""),_(""),i(""),U("")},W=w||v||h||j,oe=(n,V)=>{V.stopPropagation(),Q(n),S(!0)},de=()=>{t()},ve=()=>{t()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-800",children:"Roles Overview"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Monitor and track all assigned roles across your teams"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>J(!0),className:"flex items-center gap-2 px-6 py-3 bg-emerald-600 text-white rounded-xl hover:bg-emerald-700 transition-colors shadow-lg hover:shadow-xl",children:[e.jsx(Se,{className:"w-5 h-5"}),"Assign to Recruiter"]}),e.jsxs("button",{onClick:()=>A(!0),className:"flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors shadow-lg hover:shadow-xl",children:[e.jsx(ue,{className:"w-5 h-5"}),"Create Role"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-2xl p-5 text-white shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-indigo-100 text-sm font-medium",children:"Total Roles"}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:k.total})]}),e.jsx(ae,{className:"w-10 h-10 text-indigo-200"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl p-5 text-white shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-emerald-100 text-sm font-medium",children:"Active"}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:k.active})]}),e.jsx(ie,{className:"w-10 h-10 text-emerald-200"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-5 text-white shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:"Deals"}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:k.deals})]}),e.jsx(ge,{className:"w-10 h-10 text-blue-200"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-red-500 to-red-600 rounded-2xl p-5 text-white shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-red-100 text-sm font-medium",children:"Lost"}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:k.lost})]}),e.jsx(he,{className:"w-10 h-10 text-red-200"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-2xl p-5 text-white shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-100 text-sm font-medium",children:"On Hold"}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:k.on_hold})]}),e.jsx(Ie,{className:"w-10 h-10 text-yellow-200"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl p-5 text-white shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-100 text-sm font-medium",children:"No Answer"}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:k.no_answer})]}),e.jsx(he,{className:"w-10 h-10 text-orange-200"})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-slate-600"}),e.jsx("h3",{className:"font-semibold text-slate-800",children:"Filters"}),W&&e.jsx("button",{onClick:le,className:"text-sm text-indigo-600 hover:text-indigo-800 font-medium ml-2",children:"Clear all"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(cs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",value:j,onChange:n=>U(n.target.value),placeholder:"Search by title, code...",className:"w-full pl-10 pr-4 py-2.5 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Status"}),e.jsxs("select",{value:w,onChange:n=>I(n.target.value),className:"w-full px-4 py-2.5 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all appearance-none bg-white",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active Only"}),e.jsx("option",{value:"non-active",children:"Non-Active"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Client"}),e.jsxs("select",{value:v,onChange:n=>_(n.target.value),className:"w-full px-4 py-2.5 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all appearance-none bg-white",children:[e.jsx("option",{value:"",children:"All Clients"}),a.map(n=>e.jsxs("option",{value:String(n.id),children:[n.name," (",n.client_code,")"]},n.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Team"}),e.jsxs("select",{value:h,onChange:n=>i(n.target.value),className:"w-full px-4 py-2.5 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all appearance-none bg-white",children:[e.jsx("option",{value:"",children:"All Teams"}),b.map(n=>e.jsxs("option",{value:String(n.id),children:[n.name," (",n.team_code,")"]},n.id))]})]})]})]}),M?e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-indigo-600 border-t-transparent mb-4"}),e.jsx("p",{className:"text-slate-500",children:"Loading roles..."})]})}):o.length===0?e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-2",children:"No roles found"}),e.jsx("p",{className:"text-slate-500 mb-4",children:W?"Try adjusting your filters to see more results":"No roles have been assigned yet"}),W&&e.jsx("button",{onClick:le,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"Clear Filters"})]})}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-50 to-slate-100 border-b border-slate-200",children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Role Code"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Title"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Team"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Account Manager"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:o.map(n=>{const V=Y(n.status),ce=V.icon;return e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors cursor-pointer",onClick:()=>H(n),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"font-mono text-sm font-semibold text-indigo-600 bg-indigo-50 px-2 py-1 rounded-md",children:n.role_code})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-800 truncate",children:n.title}),n.description&&e.jsx("p",{className:"text-xs text-slate-500 truncate mt-0.5",children:n.description})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium border ${V.color} ${V.bg}`,children:[e.jsx(ce,{className:"w-3.5 h-3.5"}),V.label]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-800",children:n.client_name}),e.jsx("p",{className:"text-xs text-slate-500 font-mono",children:n.client_code})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-800",children:n.team_name}),e.jsx("p",{className:"text-xs text-slate-500 font-mono",children:n.team_code})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-800",children:n.account_manager_name}),e.jsx("p",{className:"text-xs text-slate-500 font-mono",children:n.account_manager_code})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("p",{className:"text-sm text-slate-700",children:new Date(n.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:me=>{me.stopPropagation(),H(n)},className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"View Details",children:e.jsx(ns,{className:"w-4 h-4"})}),e.jsx("button",{onClick:me=>oe(n,me),className:"p-2 text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors",title:"Edit Role",children:e.jsx(_e,{className:"w-4 h-4"})})]})})]},n.id)})})]})}),e.jsx("div",{className:"px-6 py-3 bg-slate-50 border-t border-slate-200",children:e.jsxs("p",{className:"text-sm text-slate-600",children:["Showing ",e.jsx("span",{className:"font-semibold text-slate-800",children:o.length})," of ",e.jsx("span",{className:"font-semibold text-slate-800",children:d.length})," roles"]})})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-indigo-600 to-indigo-700 px-8 py-6 flex items-center justify-between text-white z-10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Role Details"}),e.jsx("p",{className:"text-indigo-100 text-sm mt-1 font-mono",children:u.role_code})]}),e.jsx("button",{onClick:()=>H(null),className:"text-white hover:bg-white/20 rounded-full p-2 transition-colors",children:e.jsx(ne,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-8 overflow-y-auto max-h-[calc(90vh-120px)]",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:(()=>{const n=Y(u.status),V=n.icon;return e.jsxs("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-xl border ${n.color} ${n.bg}`,children:[e.jsx(V,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:n.label})]})})()}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide",children:"Title"}),e.jsx("p",{className:"text-2xl font-bold text-slate-800 mt-2",children:u.title})]}),u.description&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide",children:"Description"}),e.jsx("p",{className:"text-slate-700 mt-2 leading-relaxed",children:u.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-5 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"bg-indigo-100 rounded-lg p-2",children:e.jsx(je,{className:"w-5 h-5 text-indigo-600"})}),e.jsx("label",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide",children:"Client"})]}),e.jsx("p",{className:"text-lg font-bold text-slate-800",children:u.client_name}),e.jsx("p",{className:"text-sm text-slate-500 font-mono mt-1",children:u.client_code})]}),e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-5 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"bg-emerald-100 rounded-lg p-2",children:e.jsx(X,{className:"w-5 h-5 text-emerald-600"})}),e.jsx("label",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide",children:"Team"})]}),e.jsx("p",{className:"text-lg font-bold text-slate-800",children:u.team_name}),e.jsx("p",{className:"text-sm text-slate-500 font-mono mt-1",children:u.team_code})]}),e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-5 border border-slate-200 md:col-span-2",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-lg p-2",children:e.jsx(fe,{className:"w-5 h-5 text-blue-600"})}),e.jsx("label",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide",children:"Account Manager"})]}),e.jsx("p",{className:"text-lg font-bold text-slate-800",children:u.account_manager_name}),e.jsx("p",{className:"text-sm text-slate-500 font-mono mt-1",children:u.account_manager_code})]}),e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-5 border border-slate-200 md:col-span-2",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"bg-purple-100 rounded-lg p-2",children:e.jsx(es,{className:"w-5 h-5 text-purple-600"})}),e.jsx("label",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide",children:"Created Date"})]}),e.jsx("p",{className:"text-lg font-bold text-slate-800",children:new Date(u.created_at).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]})]})}),e.jsxs("div",{className:"sticky bottom-0 bg-slate-50 border-t border-slate-200 px-8 py-4 flex gap-3",children:[e.jsx("button",{onClick:()=>H(null),className:"flex-1 px-6 py-3 bg-slate-200 text-slate-700 rounded-xl hover:bg-slate-300 font-medium transition-colors",children:"Close"}),e.jsxs("button",{onClick:()=>{u&&(Q(u),S(!0),H(null))},className:"flex-1 px-6 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 font-medium transition-colors flex items-center justify-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5"}),"Edit Role"]})]})]})}),e.jsx(Ns,{isOpen:p,onClose:()=>A(!1),onSuccess:de}),e.jsx(ws,{isOpen:c,role:G,onClose:()=>{S(!1),Q(null)},onSuccess:ve}),e.jsx(ys,{isOpen:P,onClose:()=>J(!1),onSuccess:()=>{}})]})}function Ss(){const[d,N]=l.useState([]),[a,q]=l.useState(null),[b,D]=l.useState([]),[M,L]=l.useState([]),[w,I]=l.useState(!0),[v,_]=l.useState(!1),[h,i]=l.useState(!1),[j,U]=l.useState(""),[u,H]=l.useState(null),[p,A]=l.useState("");l.useEffect(()=>{c()},[]),l.useEffect(()=>{a&&(S(),P())},[a]);const c=async()=>{try{I(!0);const t=await g("/api/rm/teams");if(t.ok){const o=await t.json();N(o),o.length>0&&!a&&q(o[0])}}catch(t){console.error("Failed to fetch teams:",t)}finally{I(!1)}},S=async()=>{if(a)try{const t=await g(`/api/rm/team-recruiters/${a.id}`);if(t.ok){const o=await t.json();D(o)}}catch(t){console.error("Failed to fetch team recruiters:",t)}},P=async()=>{if(a)try{const t=await g(`/api/rm/available-recruiters?team_id=${a.id}`);if(t.ok){const o=await t.json();L(o)}}catch(t){console.error("Failed to fetch available recruiters:",t)}},J=async()=>{if(!(!j||!a))try{(await g("/api/rm/team-recruiters",{method:"POST",body:JSON.stringify({team_id:a.id,recruiter_user_id:parseInt(j)})})).ok&&(_(!1),U(""),S(),P())}catch(t){console.error("Failed to add recruiter:",t)}},G=t=>{H(t),A(""),i(!0)},Q=async()=>{if(!u||!a||!p)return;const t=parseInt(p);if(t===a.id){alert("Recruiter is already in this team");return}try{if(!(await g(`/api/rm/team-recruiters/${a.id}/${u.id}`,{method:"DELETE"})).ok)throw new Error("Failed to remove recruiter from current team");if(!(await g("/api/rm/team-recruiters",{method:"POST",body:JSON.stringify({team_id:t,recruiter_user_id:u.id})})).ok)throw await g("/api/rm/team-recruiters",{method:"POST",body:JSON.stringify({team_id:a.id,recruiter_user_id:u.id})}),new Error("Failed to add recruiter to new team");i(!1),H(null),A(""),S(),P()}catch(o){console.error("Failed to update recruiter team:",o),alert("Failed to update recruiter team assignment")}},m=async t=>{if(a&&confirm("Are you sure you want to remove this recruiter from the team?"))try{(await g(`/api/rm/team-recruiters/${a.id}/${t}`,{method:"DELETE"})).ok&&(S(),P())}catch(o){console.error("Failed to remove recruiter:",o)}};return w?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Team Management"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Manage recruiters in your teams"})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-6",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"Select Team"}),e.jsx("select",{value:(a==null?void 0:a.id)||"",onChange:t=>{const o=d.find(k=>k.id===parseInt(t.target.value));q(o||null)},className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-lg",children:d.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.team_code,")"]},t.id))})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-500 rounded-2xl shadow-lg p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:a.name}),e.jsx("p",{className:"text-indigo-100 mt-1 font-mono",children:a.team_code})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-4xl font-bold",children:b.length}),e.jsx("div",{className:"text-indigo-100 text-sm",children:"Recruiters"})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Team Recruiters"})]}),e.jsxs("button",{onClick:()=>_(!0),className:"px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg font-medium hover:from-indigo-700 hover:to-purple-700 transition-all flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Add Recruiter"]})]}),b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ds,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500",children:"No recruiters assigned to this team"}),e.jsx("button",{onClick:()=>_(!0),className:"mt-4 text-indigo-600 hover:text-indigo-800 font-medium",children:"Add your first recruiter"})]}):e.jsx("div",{className:"divide-y divide-slate-200",children:b.map(t=>e.jsxs("div",{className:"px-6 py-4 flex items-center justify-between hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold",children:t.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-800",children:t.name}),e.jsx("p",{className:"text-sm text-slate-500",children:t.email}),e.jsx("p",{className:"text-xs text-slate-400 font-mono",children:t.user_code})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[t.assigned_at&&e.jsxs("div",{className:"text-right text-sm text-slate-500",children:[e.jsx("p",{children:"Added"}),e.jsx("p",{children:new Date(t.assigned_at).toLocaleDateString()})]}),e.jsx("button",{onClick:()=>G(t),className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Change team",children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>m(t.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove from team",children:e.jsx(Ue,{className:"w-4 h-4"})})]})]},t.id))})]})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800",children:"Add Recruiter to Team"}),e.jsx("button",{onClick:()=>{_(!1),U("")},className:"text-slate-400 hover:text-slate-600",children:e.jsx(ne,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Recruiter"}),e.jsxs("select",{value:j,onChange:t=>U(t.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Choose a recruiter..."}),M.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.user_code,")"]},t.id))]}),M.length===0&&e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"No available recruiters. All recruiters are already assigned to this team."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>{_(!1),U("")},className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:J,disabled:!j,className:"flex-1 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg font-medium hover:from-indigo-700 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Add to Team"})]})]})]})}),h&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800",children:"Change Team Assignment"}),e.jsx("button",{onClick:()=>{i(!1),H(null),A("")},className:"text-slate-400 hover:text-slate-600",children:e.jsx(ne,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Recruiter"}),e.jsx("p",{className:"font-semibold text-slate-800",children:u.name}),e.jsx("p",{className:"text-sm text-slate-500 font-mono",children:u.user_code})]}),e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-indigo-600 mb-1",children:"Current Team"}),e.jsxs("p",{className:"font-semibold text-indigo-800",children:[a==null?void 0:a.name," (",a==null?void 0:a.team_code,")"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Move to Team"}),e.jsxs("select",{value:p,onChange:t=>A(t.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select a team..."}),d.filter(t=>t.id!==(a==null?void 0:a.id)).map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.team_code,")"]},t.id))]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>{i(!1),H(null),A("")},className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Q,disabled:!p,className:"flex-1 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg font-medium hover:from-indigo-700 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Move to Team"})]})]})]})})]})}function ks(){const{user:d}=Le(),[N,a]=l.useState([]),[q,b]=l.useState([]),[D,M]=l.useState(!0);l.useEffect(()=>{L()},[]);const L=async()=>{try{const[w,I]=await Promise.all([g("/api/rm/clients"),g("/api/rm/teams")]);if(w.ok){const v=await w.json();a(v)}if(I.ok){const v=await I.json();b(v)}}catch(w){console.error("Failed to fetch assignments:",w)}finally{M(!1)}};return D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Profile"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Your account information and assignments"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl shadow-2xl p-8 text-white",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-24 h-24 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center",children:e.jsx(qe,{className:"w-16 h-16 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-3xl font-bold mb-2",children:d==null?void 0:d.name}),e.jsxs("div",{className:"flex items-center gap-2 text-white/80 mb-1",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsx("span",{children:d==null?void 0:d.email})]}),e.jsxs("div",{className:"flex items-center gap-2 text-white/80",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{className:"font-mono",children:d==null?void 0:d.user_code})]})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-white/20",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Role"}),e.jsx("p",{className:"text-xl font-bold",children:"Recruitment Manager"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Status"}),e.jsx("p",{className:"text-xl font-bold",children:"Active"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(je,{className:"w-6 h-6 text-indigo-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Assigned Clients"})]}),e.jsx("div",{className:"space-y-3",children:N.length>0?N.map(w=>e.jsx("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:w.name}),e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:w.client_code})]})},w.id)):e.jsx("p",{className:"text-gray-500 text-sm",children:"No clients assigned"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(X,{className:"w-6 h-6 text-indigo-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Assigned Teams"})]}),e.jsx("div",{className:"space-y-3",children:q.length>0?q.map(w=>e.jsx("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:w.name}),e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:w.team_code})]})},w.id)):e.jsx("p",{className:"text-gray-500 text-sm",children:"No teams assigned"})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(te,{className:"w-6 h-6 text-gray-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Account Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"User ID"}),e.jsx("p",{className:"font-semibold text-gray-900",children:d==null?void 0:d.id})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"User Code"}),e.jsx("p",{className:"font-mono font-semibold text-gray-900",children:d==null?void 0:d.user_code})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Clients Managed"}),e.jsx("p",{className:"font-semibold text-gray-900",children:N.length})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Teams Managed"}),e.jsx("p",{className:"font-semibold text-gray-900",children:q.length})]})]})]})]})}function Rs(){const[d,N]=l.useState([]),[a,q]=l.useState(!0),[b,D]=l.useState(null),[M,L]=l.useState(""),[w,I]=l.useState(!1);l.useEffect(()=>{v()},[]);const v=async()=>{try{const h=await g("/api/rm/dropout-requests");if(h.ok){const i=await h.json();N(i)}}catch(h){console.error("Failed to fetch dropout requests:",h)}finally{q(!1)}},_=async()=>{if(b){I(!0);try{(await g(`/api/rm/dropout-requests/${b.id}/acknowledge`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({rm_notes:M})})).ok?(N(i=>i.filter(j=>j.id!==b.id)),D(null),L("")):alert("Failed to acknowledge dropout request")}catch(h){console.error("Failed to acknowledge:",h),alert("Failed to acknowledge dropout request")}finally{I(!1)}}};return a?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-indigo-200 border-t-indigo-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Dropout Requests"}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-orange-100 rounded-lg",children:[e.jsx(re,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"text-sm font-medium text-orange-800",children:[d.length," Pending"]})]})]}),d.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[e.jsx(ie,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-2",children:"All Caught Up!"}),e.jsx("p",{className:"text-slate-600",children:"No pending dropout requests to review."})]}):e.jsx("div",{className:"grid gap-4",children:d.map(h=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium",children:"Dropout"}),e.jsx("span",{className:"text-sm text-slate-500",children:new Date(h.created_at).toLocaleDateString()})]}),e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-1",children:h.role_title}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Role Code:"}),e.jsx("span",{className:"ml-2 font-medium text-slate-800",children:h.role_code})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Client:"}),e.jsx("span",{className:"ml-2 font-medium text-slate-800",children:h.client_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Recruiter:"}),e.jsxs("span",{className:"ml-2 font-medium text-slate-800",children:[h.recruiter_name," (",h.recruiter_code,")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Account Manager:"}),e.jsx("span",{className:"ml-2 font-medium text-slate-800",children:h.am_name})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-slate-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ss,{className:"w-4 h-4 text-slate-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 block mb-1",children:"Dropout Reason:"}),e.jsx("p",{className:"text-sm text-slate-600",children:h.dropout_reason})]})]})})]})}),e.jsx("button",{onClick:()=>D(h),className:"w-full mt-4 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:"Review & Acknowledge"})]},h.id))}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-slate-200",children:e.jsx("h3",{className:"text-xl font-bold text-slate-800",children:"Acknowledge Dropout Request"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-3",children:"Request Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Role:"}),e.jsx("span",{className:"font-medium text-slate-800",children:b.role_title})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Code:"}),e.jsx("span",{className:"font-medium text-slate-800",children:b.role_code})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Recruiter:"}),e.jsxs("span",{className:"font-medium text-slate-800",children:[b.recruiter_name," (",b.recruiter_code,")"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Client:"}),e.jsx("span",{className:"font-medium text-slate-800",children:b.client_name})]})]})]}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-orange-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-orange-800 mb-1",children:"Recruiter's Reason:"}),e.jsx("p",{className:"text-sm text-orange-700",children:b.dropout_reason})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Your Notes (for Account Manager)"}),e.jsx("textarea",{value:M,onChange:h=>L(h.target.value),placeholder:"Add your observations or recommendations...",rows:4,className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"These notes will be shared with the Account Manager to help them make a decision."})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["By acknowledging this request, you're forwarding it to the Account Manager (",b.am_name,") for final decision. They will determine if the dropout penalty applies."]})})]}),e.jsxs("div",{className:"p-6 border-t border-slate-200 flex gap-3",children:[e.jsx("button",{onClick:()=>{D(null),L("")},disabled:w,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:_,disabled:w,className:"flex-1 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Acknowledging..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4"}),"Acknowledge & Forward to AM"]})})]})]})})]})}function qs(){return e.jsx(fs,{children:e.jsxs(Ye,{children:[e.jsx(ee,{path:"/",element:e.jsx(js,{})}),e.jsx(ee,{path:"/analytics",element:e.jsx(vs,{})}),e.jsx(ee,{path:"/roles",element:e.jsx(_s,{})}),e.jsx(ee,{path:"/team",element:e.jsx(Ss,{})}),e.jsx(ee,{path:"/dropouts",element:e.jsx(Rs,{})}),e.jsx(ee,{path:"/company",element:e.jsx(ts,{})}),e.jsx(ee,{path:"/profile",element:e.jsx(ks,{})}),e.jsx(ee,{path:"*",element:e.jsx(Ve,{to:"/rm",replace:!0})})]})})}export{qs as default};
