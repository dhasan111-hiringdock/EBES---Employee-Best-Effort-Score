var E,A;const w=((A=(E=import.meta)==null?void 0:E.env)==null?void 0:A.VITE_API_BASE_URL)??"",r=new Map,m=5e3;async function C(t,e){var d,f;const l=localStorage.getItem("user");if(!l)throw new Error("No user session found");let a;try{if(a=(d=JSON.parse(l).id)==null?void 0:d.toString(),!a)throw new Error("Invalid user data")}catch{throw localStorage.removeItem("user"),new Error("Invalid session")}const I={"Content-Type":"application/json","x-user-id":a,...e==null?void 0:e.headers},u={...e,headers:I},o=((f=e==null?void 0:e.method)==null?void 0:f.toUpperCase())||"GET",c=t.startsWith("http://")||t.startsWith("https://")?t:w?`${w}${t}`:t;if(o!=="GET"&&r.clear(),o==="GET"){const s=`${o}:${c}`,i=r.get(s);if(i&&Date.now()-i.timestamp<m)return new Response(JSON.stringify(i.data),{status:200,headers:{"Content-Type":"application/json"}});const h=await fetch(c,u);if(h.ok)try{const n=h.clone(),p=(n.headers.get("content-type")||"").includes("application/json")?await n.json():null;p!==null&&r.set(s,{data:p,timestamp:Date.now()}),setTimeout(()=>{r.delete(s)},m)}catch(n){console.warn("Failed to cache response:",n)}return h}return fetch(c,u)}export{C as f};
